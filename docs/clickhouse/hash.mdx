---
sidebar_position: 2
id: hash
title: CityHash
---

ClickHouse uses **one of previous** versions of [CityHash from Google](https://github.com/google/cityhash).

:::info
CityHash has changed the algorithm after we have added it into ClickHouse.

CityHash documentation specifically notes that the user should not rely to specific hash values and should not save it anywhere or use it as sharding key.

But as we exposed this function to the user, we had to fix the version of CityHash (to 1.0.2). And now we guarantee that the behaviour of CityHash functions available in SQL will not change.

â€” Alexey Milovidov, [comment](https://github.com/ClickHouse/ClickHouse/issues/8354#issuecomment-568517969) on issue.
:::

:::danger Note

Current version of Google's CityHash [differs](https://github.com/ClickHouse/ClickHouse/issues/8354) from ClickHouse `cityHash64` variant.

Use `farmHash64` function to get Google's CityHash value.

:::

You can use [go-faster/city](https://github.com/go-faster/city) Go package that implements both variants.

Also see [Introducing CityHash](https://opensource.googleblog.com/2011/04/introducing-cityhash.html) for description and
reasoning behind creation. TL;DR **non-cryptographic** hash that is faster than [MurmurHash](http://en.wikipedia.org/wiki/MurmurHash), but more complex.

## Examples

Let's take 64-bit hash from `Moscow` string.

```sql
:) SELECT cityHash64('Moscow')
12507901496292878638
```
```sql
:) SELECT farmHash64('Moscow')
5992710078453357409
```

```go
s := []byte("Moscow")
fmt.Print("ClickHouse: ")
fmt.Println(city.CH64(s))
fmt.Print("CityHash:   ")
fmt.Println(city.Hash64(s))
// Output:
// ClickHouse: 12507901496292878638
// CityHash:   5992710078453357409
```

## Benchmarks

```
goos: linux
goarch: amd64
pkg: github.com/go-faster/city
cpu: AMD Ryzen 9 5950X 16-Core Processor
BenchmarkClickHouse128-32     137.7 ns/op  7437.19 MB/s  0 B/op  0 allocs/op
BenchmarkClickHouse64-32      131.5 ns/op  7786.84 MB/s  0 B/op  0 allocs/op
BenchmarkCityHash32-32        333.9 ns/op  3066.73 MB/s  0 B/op  0 allocs/op
BenchmarkCityHash64-32        141.9 ns/op  7216.10 MB/s  0 B/op  0 allocs/op
BenchmarkCityHash128-32       148.5 ns/op  6897.44 MB/s  0 B/op  0 allocs/op
BenchmarkCityHash64Small-32   3.659 ns/op  2732.82 MB/s  0 B/op  0 allocs/op
BenchmarkCityHash128Small-32  9.103 ns/op  1098.57 MB/s  0 B/op  0 allocs/op
PASS
ok      github.com/go-faster/city       12.018s
```
